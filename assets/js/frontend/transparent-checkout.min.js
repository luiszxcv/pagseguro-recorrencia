!function(e){"use strict";e(function(){var r=!1;function a(r){"credit-card"===e("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val()?e("#pagseguro-credit-card-form").attr("data-credit-card-brand",r):e("#pagseguro-recorrence-form").attr("data-credit-card-brand",r)}function o(r,o=!0){PagSeguroDirectPayment.getBrand({cardBin:r,async:o,success:function(r){e("body").trigger("pagseguro_credit_card_brand",r.brand.name),a(r.brand.name)},error:function(){e("body").trigger("pagseguro_credit_card_brand","error"),a("error")}})}function t(e){return'<option value="'+e.quantity+'" data-installment-value="'+e.installmentAmount+'">'+function(e){var r="R$ "+parseFloat(e.installmentAmount,10).toFixed(2).replace(".",",").toString(),a="R$ "+parseFloat(e.totalAmount,10).toFixed(2).replace(".",",").toString(),o=!0===e.interestFree?" "+wc_pagseguro_params.interest_free:"",t=o||" ("+a+")";return e.quantity+"x "+r+t}(e)+"</option>"}function n(r,a){var o=e("recorrence"==a?"#pagseguro-recorrence-form":"#pagseguro-credit-card-form");e(".woocommerce-error",o).remove(),o.prepend('<div class="woocommerce-error" style="margin-bottom: 0.5em !important;">'+r+"</div>")}function c(r){e(".pagseguro-method-form").hide(),e("#pagseguro-payment-methods li").removeClass("active"),e("#pagseguro-"+r+"-form").show(),e("#pagseguro-payment-method-"+r).parent("label").parent("li").addClass("active")}function d(){var r;r=e("#pagseguro-payment-methods"),1===e("input[type=radio]",r).length&&r.hide(),e("#pagseguro-payment-form").show(),c(e("#pagseguro-payment-methods input[type=radio]:checked").val()),e("#pagseguro-card-holder-cpf").mask("000.000.000-00"),e("#pagseguro-card-holder-birth-date").mask("00/00/0000");var a=function(e){return 11===e.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},o={onKeyPress:function(e,r,o,t){o.mask(a.apply({},arguments),t)}};e("#pagseguro-card-holder-phone").mask(a,o),e("#pagseguro-bank-transfer-form input[type=radio]:checked").parent("label").parent("li").addClass("active"),e("#pagseguro-card-holder-cpf-recorrence").mask("000.000.000-00"),e("#pagseguro-card-holder-birth-date-recorrence").mask("00/00/0000"),e("#pagseguro-card-holder-phone-recorrence").mask(a,o)}function g(){if(r)return r=!1,!0;if(!e("#payment_method_pagseguro").is(":checked"))return!0;if("credit-card"!==e("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val()&&"recorrence"!==e("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val())return e("form.checkout, form#order_review").append(e('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),!0;if("credit-card"===e("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val())var a=e("form.checkout, form#order_review"),o=!1,t="",c=e("#pagseguro-credit-card-form",a).attr("data-credit-card-brand"),d=e("#pagseguro-card-number",a).val().replace(/[^\d]/g,""),g=e("#pagseguro-card-cvc",a).val(),s=e("#pagseguro-card-expiry",a).val().replace(/[^\d]/g,"").substr(0,2),p=e("#pagseguro-card-expiry",a).val().replace(/[^\d]/g,"").substr(2),u=e("#pagseguro-card-installments",a),i=new Date;else{a=e("form.checkout, form#order_review"),o=!1,t="",c=e("#pagseguro-recorrence-form",a).attr("data-credit-card-brand");d=e("#pagseguro-card-number-recorrence",a).val().replace(/[^\d]/g,""),g=e("#pagseguro-card-cvc-recorrence",a).val(),s=e("#pagseguro-card-expiry-recorrence",a).val().replace(/[^\d]/g,"").substr(0,2),p=e("#pagseguro-card-expiry-recorrence",a).val().replace(/[^\d]/g,"").substr(2),u=e("#pagseguro-card-recorrence-time-recorrence",a),i=new Date}return t+="<ul>",void 0!==c&&"error"!==c||(t+="<li>"+wc_pagseguro_params.invalid_card+"</li>",o=!0),2===s.length&&4===p.length||(t+="<li>"+wc_pagseguro_params.invalid_expiry+"</li>",o=!0),2===s.length&&4===p.length&&(s>12||p<=i.getFullYear()-1||p>=i.getFullYear()+20||s<i.getMonth()+2&&p.toString()===i.getFullYear().toString())&&(t+="<li>"+wc_pagseguro_params.expired_date+"</li>",o=!0),"0"!==u.val()&&""!==u.val()||(t+="<li>"+wc_pagseguro_params.empty_installments+"</li>",o=!0),t+="</ul>",o?n(t,e("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val()):PagSeguroDirectPayment.createCardToken({brand:c,cardNumber:d,cvv:g,expirationMonth:s,expirationYear:p,success:function(o){e("input[name=pagseguro_credit_card_hash], input[name=pagseguro_credit_card_hash], input[name=pagseguro_installment_value]",a).remove(),a.append(e('<input name="pagseguro_credit_card_hash" type="hidden" />').val(o.card.token)),a.append(e('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),a.append(e('<input name="pagseguro_installment_value" type="hidden" />').val(e("option:selected",u).attr("data-installment-value"))),r=!0,a.submit()},error:function(){alert(wc_pagseguro_params.general_error),n(wc_pagseguro_params.general_error)}}),!1}e("body").mousemove(function(){""!=e("#pagseguro-recorrence-form").attr("data-credit-card-brand")&&e("#pagseguro-recorrence-form").attr("data-credit-card-brand")||o(e("#pagseguro-card-number-recorrence").val().replace(/[^\d]/g,"").substr(0,6),!1)}),wc_pagseguro_params.session_id?(PagSeguroDirectPayment.setSessionId(wc_pagseguro_params.session_id),"1"===wc_checkout_params.is_checkout?e("body").on("updated_checkout",function(){d()}):d(),e("body").on("click","#pagseguro-bank-transfer-form input[type=radio]",function(){e("#pagseguro-bank-transfer-form li").removeClass("active"),e(this).parent("label").parent("li").addClass("active")}),e("body").on("click","#pagseguro-payment-methods input[type=radio]",function(){c(e(this).val())}),e("body").on("focusout","#pagseguro-card-number,#pagseguro-card-number-recorrence",function(){var r=e(this).val().replace(/[^\d]/g,"").substr(0,6),a=e("body #pagseguro-card-installments");6===r.length&&(a.empty(),a.attr("disabled","disabled"),o(r))}),e("body").on("updated_checkout",function(){var r=e("body #pagseguro-card-number");0<r.length&&r.focusout()}),e("body").on("focus","#pagseguro-card-number, #pagseguro-card-expiry",function(){e("#pagseguro-credit-card-form .woocommerce-error").remove()}),e("body").on("pagseguro_credit_card_brand",function(r,a){"error"!==a?PagSeguroDirectPayment.getInstallments({amount:e("body #pagseguro-payment-form").data("cart_total"),brand:a,success:function(r){var o=e("body #pagseguro-card-installments");!1===r.error?(o.empty(),o.removeAttr("disabled"),o.append('<option value="0">--</option>'),e.each(r.installments[a],function(e,r){o.append(t(r))})):n(wc_pagseguro_params.invalid_card)},error:function(){n(wc_pagseguro_params.invalid_card)}}):n(wc_pagseguro_params.invalid_card)}),e("form.checkout").on("checkout_place_order_pagseguro",function(){return g()}),e("form#order_review").submit(function(){return g()})):e("body").on("updated_checkout",function(){e("#pagseguro-payment-form").remove()})})}(jQuery);